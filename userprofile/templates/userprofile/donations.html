{% extends '_layout.html' %}
{% load donation_extras %}

{% block title %} Profile | {{ block.super }}{% endblock %}

{% block head_extra %}
    <script>
        $(document).on("click", ".delete-plan", function(event) {
            event.preventDefault();
            var url = "{% url 'plans:delete_plan' %}";
            var id = $(this).attr("id");
            $.ajax({
                url : url,
                type : "POST",
                traditional: true,
                data : {
                    id : id
                },
                success : function(json) {
                    var plan = $("#" + id)
                    plan.closest("li").remove();
                }
            });
        });
    </script>
{% endblock %}

{% block body_content %}
    <div class="row">
        <div class="col-lg-3">
            {% include "userprofile/profile_menu.html" %}
        </div>
        <div class="col-lg-9">
            <p><a href="{% url 'userprofile:userprofile_taxes' %}" target="_blank">Print donation history for taxes</a></p>

            <h2>Recurring Donations</h2>
            {% if userprofile.plans %}
                <ul>
                    {% for p in userprofile.plans %}
                        <li id="test">{{ p.amount|cents_to_dollars }} every {{ p.interval }} to <a href="{% url 'page' page_slug=p.page.page_slug %}">{{ p.page }}</a>{% if p.campaign %} via <a href="{% url 'campaign' page_slug=p.page.page_slug campaign_pk=p.campaign.pk campaign_slug=p.campaign.campaign_slug %}">{{ p.campaign }}</a>{% endif %} - <a class="delete-plan" id="plan-{{ p.id }}" href="">Delete</a></li>
                    {% endfor %}
                </ul>
            {% endif %}

            <h2>Donations</h2>
            {% if userprofile.donations %}
                <ul>
                    {% for d in userprofile.donations %}
                        <li>{{ d.amount|cents_to_dollars }} to <a href="{% url 'page' page_slug=d.page.page_slug %}">{{ d.page }}</a>{% if d.campaign %} via <a href="{% url 'campaign' page_slug=d.page.page_slug campaign_pk=d.campaign.pk campaign_slug=d.campaign.campaign_slug %}">{{ d.campaign }}</a>{% endif %} @ {{ d.date }}</li>
                    {% endfor %}
                </ul>
            {% endif %}
        </div>
    </div>
{% endblock %}
