{% extends '_layout.html' %}
{% load static from staticfiles %}
{% load donation_extras %}
{% load page_extras %}
{% load userprofile_extras %}

{% block title %} Profile | {{ block.super }}{% endblock %}

{% block head_extra %}
    <script src="{% static 'js/comment_csrf.js' %}"></script>

    <script>
        $(document).on("click", ".set-default", function(event) {
            event.preventDefault();
            var url = "{% url 'donation:default_card' %}";
            var id = $(this).closest("span").attr("id");
            $.ajax({
                url : url,
                type : "POST",
                traditional: true,
                data : {
                    id : id
                },
                success : function(json) {
                    $(".default").html("<a class='set-default' href=''>Set default</a>");
                    $("#default-" + json.id).text("Default");
                }
            });
        });

        $(document).on("click", ".delete-plan", function(event) {
            event.preventDefault();
            var url = "{% url 'plans:delete_plan' %}";
            var id = $(this).attr("id");
            $.ajax({
                url : url,
                type : "POST",
                traditional: true,
                data : {
                    id : id
                },
                success : function(json) {
                    var plan = $("#" + id)
                    plan.closest("li").remove();
                }
            });
        });
    </script>

{% endblock %}

{% block body_content %}

    <div class="row">
        <div class="col-lg-3">
            {% include "userprofile/profile_menu.html" %}
        </div>
    </div>



    <img src="{{ userprofile.profile_picture.image.url }}" width="300"/>
    
    <form action="" method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.as_p }}
        <input type="submit" value="Update profile" />
    </form>

    <p><a href="{% url 'userprofile:user_image_upload' %}">Upload and Edit images</a></p>

    <h3>User Images</h3>
    <ul>
        {% for image in userprofile.images %}
            <li><img src="{{ image.image.url }}" width="200" />{{ image.caption }}</li>
        {% endfor %}
    </ul>

{% endblock %}
