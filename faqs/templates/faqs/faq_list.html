{% extends '_layout.html' %}
{% load static from staticfiles %}
{% load votes_extras %}

{% block title %} FAQs | {{ block.super }}{% endblock %}

{% block head_extra %}
    <script src="{% static 'js/comment_csrf.js' %}"></script>
    <script>
        function vote(event) {
            var obj = $(event.target).parents().eq(2).attr("id");
            var vote = $(event.target).attr("class");
            var url = "{% url 'votes:vote' %}";

            $.ajax({
                url : url,
                type : "POST",
                traditional: true,
                data : {
                    obj : obj,
                    vote : vote,
                },
                success : function(result) {
                    $("#upvotes-" + result.pk).text(result.upvotes);
                    $("#downvotes-" + result.pk).text(result.downvotes);
                }
            });
        };

        $(document).on("click", "a[class^=vote]", function(event) {
            event.preventDefault();
            vote(event);
        });
    </script>
{% endblock %}

{% block body_content %}
    <h1>Frequently Asked Questions (FAQs)</h1>
    <ul>
        {% for faq in faqs %}
        <li id="faq-{{ faq.pk }}">
            {{ faq.question }}
            <ul>
                <li>{{ faq.answer|safe }}</li>
                {% if request.user.is_authenticated %}
                    {% user_vote_was user=request.user obj="faq" pk=faq.pk as user_vote_was %}
                    {{ user_vote_was }}
                    <li><span id="upvotes-{{ faq.pk }}">{{ faq.upvotes }}</span> <a class="vote-upvote" href="">{% if user_vote_was == "upvote" %}<span class="user-vote" style="color:green;">{% endif %}upvote{{ faq.upvotes|pluralize }}{% if user_vote_was == "upvote" %}</span>{% endif %}</a>, <span id="downvotes-{{ faq.pk }}">{{ faq.downvotes }}</span> <a class="vote-downvote" href="">{% if user_vote_was == "downvote" %}<span class="user-vote" style="color:green;">{% endif %}downvote{{ faq.downvotes|pluralize }}{% if user_vote_was == "downvote" %}</span>{% endif %}</a></li>
                {% else %}
                    <li><span id="upvotes-{{ faq.pk }}">{{ faq.upvotes }}</span> <a class="vote-upvote" href="{% url 'login' %}?next={{ request.path }}">upvote{{ faq.upvotes|pluralize }}</a>, <span id="downvotes-{{ faq.pk }}">{{ faq.downvotes }}</span> <a class="vote-downvote" href="{% url 'login' %}?next={{ request.path }}">downvote{{ faq.downvotes|pluralize }}</a></li>
                {% endif %}
            </ul>
        </li>
        {% endfor %}
    </ul>
{% endblock %}
