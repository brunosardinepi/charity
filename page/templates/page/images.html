{% extends '_layout.html' %}
{% load static from staticfiles %}

{% block title %} Upload Images | {{ block.super }}{% endblock %}

{% block head_extra %}
    <script src="{% static '/jquery-file-upload/vendor/jquery.ui.widget.js' %}"></script>
    <script src="{% static '/jquery-file-upload/jquery.iframe-transport.js' %}"></script>
    <script src="{% static '/jquery-file-upload/jquery.fileupload.js' %}"></script>
    <script src="{% static '/js/image_upload.js' %}"></script>

    <script>
        function delete_image(event) {
            var arr = event.target.id.split('-');
            var url = "{% url 'page_image_delete' image_pk=0 %}".replace(0, arr[1]);
            $.get(url, function () {
                $("#image-" + arr[1]).remove();
            });
        };

        $(document).on('click', ".delete-image", function(event) {
            event.preventDefault();
            delete_image(event);
        });

        $(document).on("click", ".set-profile-picture", function(event) {
            event.preventDefault();
            var arr = $(this).closest("span").attr("id").split('-');
            var url = "{% url 'page_profile_update' image_pk=0 %}".replace(0, arr[1]);
//            var id = $(this).closest("span").attr("id");
            $.get(url, function() {
                $(".profile").html("<a class='set-profile-picture' href=''>Make profile picture</a> - ");
                $("#profile-" + arr[1]).text("Profile picture - ");
            });
        });
    </script>

{% endblock %}

{% block breadcrumbs %}
    <a href="{% url 'page' page_slug=page.page_slug %}">{{ page.name }}</a> / Upload
{% endblock %}

{% block body_content %}
    <br />
    <button type="button" id="upload-button">Upload Images</button>
    <input id="upload-input" type="file" name="image" multiple
        style="display:none;"
        data-url="{% url 'page_image_upload' page_slug=page.page_slug %}"
        data-form-data='{"csrfmiddlewaretoken": "{{ csrf_token }}"}' />

    <h3>Images</h3>
    {% if images %}
        <ul id="image-list">
            {% for i in images %}
                <li id="image-{{ i.pk }}"><span class="profile" id="profile-{{ i.pk }}">{% if i.profile_picture %}Profile picture - {% else %}<a class="set-profile-picture" href="">Make profile picture</a> - {% endif %}</span><a href="{{ i.image.url }}">{{ i.image.name }}</a> - <a id="delete-{{ i.pk }}" class="delete-image" href="">Delete</a></li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No images!</p>
    {% endif %}
{% endblock %}

