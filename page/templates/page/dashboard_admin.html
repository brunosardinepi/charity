{% extends '_layout.html' %}
{% load static from staticfiles %}
{% load guardian_tags %}
{% load donation_extras %}

{% block title %}Dashboard | {{ block.super }}{% endblock %}

{% block head_extra %}
    <script src="{% static 'js/comment_csrf.js' %}"></script>
    <script>
        $(document).ready(function() {
            $(".delete-page").click(function () {
                return confirm("Are you sure you want to delete this Page?");
            });
        });
    </script>
{% endblock %}

{% block body_content %}

    <div class="row">
        <div class="col-lg-3">
            {% include "page/dashboard_menu.html" %}
        </div>
        <div class="col-lg-9">
            <h2>Settings</h2>
            <hr>
            {% if request.user.userprofile in page.admins.all %}
                <p><a href="{% url 'page_edit' page_slug=page.page_slug %}">Edit Page</a></p>
                <p><a href="{% url 'page_edit_bank_info' page_slug=page.page_slug %}">Edit Page bank info</a></p>
                <p><a class="delete-page" href="{% url 'page_delete' page_slug=page.page_slug %}">Delete Page</a></p>
                <p><a href="{% url 'page_invite' page_slug=page.page_slug  %}">Invite others to manage Page</a></p>
                {% if page.managers_list %}
                    <h5>Managers</h5>
                    <form method="POST" action"">
                        {% csrf_token %}
                        <table>
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Edit</th>
                                    <th>Delete</th>
                                    <th>Invite</th>
                                    <th>Upload</th>
                                    <th>View Dashboard</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for manager in page.managers_list %}
                                    {% get_obj_perms manager.user for page as "page_perms" %}
                                    <tr>
                                        <td>{{ manager.user.first_name }} {{ manager.user.last_name }}</td>
                                        <td>{{ manager.user.email }}</td>
                                        <td><input name="permissions[]" type="checkbox" value="{{ manager.pk }}_manager_edit" {% if 'manager_edit' in page_perms %}checked{% endif %} /></td>
                                        <td><input name="permissions[]" type="checkbox" value="{{ manager.pk }}_manager_delete" {% if 'manager_delete' in page_perms %}checked{% endif %} /></td>
                                        <td><input name="permissions[]" type="checkbox" value="{{ manager.pk }}_manager_invite" {% if 'manager_invite' in page_perms %}checked{% endif %} /></td>
                                        <td><input name="permissions[]" type="checkbox" value="{{ manager.pk }}_manager_image_edit" {% if 'manager_image_edit' in page_perms %}checked{% endif %} /></td>
                                        <td><input name="permissions[]" type="checkbox" value="{{ manager.pk }}_manager_view_dashboard" {% if 'manager_view_dashboard' in page_perms %}checked{% endif %} /></td>
                                        <td><a href="{% url 'remove_manager' page_slug=page.page_slug manager_pk=manager.pk %}">Remove<a/></td>
                                {% endfor %}
                            </tbody>
                        </table>
                        <input type="submit" value="Save" />
                    </form>
                {% endif %}
            {% else %}
                <p><a href="{% url 'remove_manager' page_slug=page.page_slug manager_pk=request.user.pk %}">Remove self as manager</a></p>
                {% get_obj_perms request.user for page as "page_perms" %}
                {% if "manager_edit" in page_perms %}
                    <p><a href="{% url 'page_edit' page_slug=page.page_slug %}">Edit Page</a></p>
                    <p><a href="{% url 'page_edit_bank_info' page_slug=page.page_slug %}">Edit Page bank info</a></p>
                {% endif %}
                {% if "manager_delete" in page_perms %}
                    <p><a class="delete-page" href="{% url 'page_delete' page_slug=page.page_slug %}">Delete Page</a></p>
                {% endif %}
                {% if "manager_invite" in page_perms %}
                    <p><a href="{% url 'page_invite' page_slug=page.page_slug  %}">Invite others to manage Page</a></p>
                {% endif %}
                {% if "manager_image_edit" in page_perms %}
                    <p><a href="{% url 'page_image_upload' page_slug=page.page_slug %}">Upload and Edit images</a></p>
                {% endif %}
            {% endif %}
</div>
</div>
{% endblock %}
